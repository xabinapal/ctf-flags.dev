<!DOCTYPE html>
<html lang="en">
  <head>
    {%- if page.title and page.title != '' -%}
      {%- assign page_title = page.title | append: ' | ' -%}
    {%- endif -%}

    {%- if page.competition -%}
      {%- assign competition_doc = site.competitions | where: 'key', page.competition | first -%}
      {%- if competition_doc.title -%}
        {%- assign page_title = page_title | append: competition_doc.title | append: ' | ' -%}
      {%- endif -%}
    {%- endif -%}

    {%- assign page_title = page_title | default: "" | append: site.title -%}

    {%- if page.competition -%}
      {%- assign raw_description = page.content | extract_paragraphs: 1, 'h2' -%}
      {%- assign truncate_description = true -%}
    {%- else if page.title -%}
      {%- assign raw_description = page.summary -%}
      {%- assign truncate_description = true -%}
    {%- else -%}
      {%- assign raw_description = page.summary -%}
      {%- assign truncate_description = false -%}
    {%- endif -%}

    {%- if truncate_description -%}
      {%- assign page_description = raw_description | strip_html | truncate_words: 160 -%}
    {%- else -%}
      {%- assign page_description = raw_description | strip_html -%}
    {%- endif -%}

    {%- assign page_description = page_description | strip -%}
    
    <title>{{ page_title }}</title>

    <meta charset="utf-8" />
    <meta name="robots" content="index,follow" />
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1" />

    <!-- Primary Meta Tags -->
    <meta name="title" content="{{ page_title }}" />
    <meta name="description" content="{{ page_description }}" />
    <meta name="author" content="xabito" />
    <meta name="keywords" content="ctf, writeups, challenges, infosec, cybersecurity" />
    <meta name="theme-color" content="#112c2f" />

    <!-- Vendor Tags -->
    <meta name="apple-mobile-web-app-title" content="{{ page_title }}" />
    <meta name="msapplication-TileColor" content="#112c2f" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ 'https://ctf-flags.dev' | append: page.url | absolute_url }}" />
    <meta property="og:title" content="{{ page_title }}" />
    <meta property="og:description" content="{{ page_description }}" />
    <meta property="og:image" content="https://ctf-flags.dev/caption.png" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="{{ 'https://ctf-flags.dev' | append: page.url | absolute_url }}" />
    <meta property="twitter:title" content="{{ page_title }}" />
    <meta property="twitter:description" content="{{ page_description }}" />
    <meta property="twitter:image" content="https://ctf-flags.dev/caption.png" />

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ 'https://ctf-flags.dev' | append: page.url | absolute_url }}" />

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="https://ctf-flags.dev/favicon-512.png" sizes="512x512" />
    <link rel="icon" type="image/png" href="https://ctf-flags.dev/favicon-96.png" sizes="96x96" />
    <link rel="icon" href="https://ctf-flags.dev/favicon.ico" sizes="32x32" />
    <link rel="apple-touch-icon" href="https://ctf-flags.dev/icon-180.png" sizes="180x180" />

    <!-- Manifest -->
    <link rel="manifest" href="https://ctf-flags.dev/site.webmanifest" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600&family=Space+Grotesk:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}" />

    {% include layout/analytics.html %}
  </head>
  <body>
    <div class="glow"></div>
    <header class="site-header">
      <div class="logo">
      <span class="pulse"></span>
      <a class="site-title" href="{{ '/' | relative_url }}">{{ site.title }}</a>
    </div>
    <nav class="site-nav">
      <a href="{{ '/' | relative_url }}" class="nav-link">Writeups</a>
      <a href="{{ '/resources/' | relative_url }}" class="nav-link">Resources</a>
      <a href="{{ '/utilities/' | relative_url }}" class="nav-link">Utilities</a>
      </nav>
    </header>

    <main class="site-content">
      {{ content }}
    </main>

    <footer class="site-footer">
      <p>
        Built with love by @xabito.
      </p>
      <p>
        May your exploits land and your flags submit on the first try. 
      </p>
    </footer>

    {% include layout/consent.html %}
  </body>
</html>
